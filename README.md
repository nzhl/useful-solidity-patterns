# å®ç”¨ Solidity æ¨¡å¼
---

è¿™ä¸ªä»“åº“ä¼šæŒç»­æ”¶å½•ä¸€äº›åœ¨ç°å®ç”Ÿäº§å¼€å‘è¿‡ç¨‹ä¸­æœ‰ç”¨æˆ–è€…æ¯”è¾ƒå·§å¦™çš„ Solidity/EVM æ¨¡å¼ã€‚ç›¸å…³çš„å†…å®¹ä¼šä½¿ç”¨å°½å¯èƒ½åœ°ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æ¥ç¼–å†™ï¼Œä»¥ä¾¿é™ä½é˜…è¯»è€…çš„æŠ€æœ¯é—¨æ§›ã€‚åŒæ—¶æ¯ä¸ªæ¨¡å¼çš„æ–‡æ¡£éƒ½ä¼šé™„å¸¦ç®€å•, å¯è¿è¡Œçš„ä»£ç ç¤ºä¾‹å’Œæµ‹è¯•æ¥æ›´å¥½åœ°è¯´æ˜ã€‚

*ä»“åº“ä¸‹æ‰€æœ‰çš„ä»£ç ç¤ºä¾‹éƒ½åªæ˜¯æ•™è‚²ç”¨é€”ï¼ŒæŸäº›åœ°æ–¹ä¸ºäº†æ›´æ¸…æ™°åœ°å±•ç¤ºæ¦‚å¿µç”šè‡³æ”¾å¼ƒäº†æœ€ä½³å®è·µï¼Œæ‰€ä»¥å®ƒä»¬ä¸åº”è¯¥åœ¨æ²¡æœ‰ç»è¿‡ä¸¥æ ¼æ£€æŸ¥çš„æƒ…å†µä¸‹å°±ç›´æ¥åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚*


## [Solidity æ¨¡å¼](./patterns)
- [å¸¦é€‰æ‹©å™¨çš„ ABI-encoding æ•°æ®çš„è§£ç ](./patterns/abi-decode-with-selector/)
    - ç”¨æ¥è§£ç å‡½æ•°è°ƒç”¨ä»¥åŠé”™è¯¯ä¿¡æ¯çš„æŠ€æœ¯ã€‚
- [é”™è¯¯å¤„ç†è¿›é˜¶](./patterns/error-handling)
    - å¯¹å…¶ä»–åˆçº¦æŠ›å‡ºçš„é”™è¯¯è¿›è¡Œé€‚å½“çš„å¤„ç†ä»¥æå‡ä»£ç çš„å¥å£®æ€§ã€‚
- [æ±‡ç¼–æŠ€å·§-1](./patterns/assembly-tricks-1)
    - ä¸€äº›ç²¾ç®€ã€æœ‰æ•ˆçš„æ±‡ç¼–æŠ€å·§, æœ‰åŠ©äºèŠ‚çœ gas çš„åŒæ—¶ç»•å¼€ä¸€äº› Solidity è¯­è¨€æœ¬èº«çš„é™åˆ¶ã€‚
- [ä»£ç†æ¨¡å¼åŸºç¡€](./patterns/basic-proxies)
    - å¯å‡çº§åˆçº¦ç›¸å…³çš„é€»è¾‘ã€‚
- [è¾ƒå¤§æ•°æ®çš„å­˜å‚¨ (SSTORE2)](./patterns/big-data-storage)
    - ä¸€ç§æ›´åŠ èŠ‚çœ gas çš„åˆ©ç”¨é“¾ä¸Šåˆçº¦ä»£ç å­˜å‚¨ç©ºé—´æ¥å‚¨å­˜ä»»æ„æ•°æ®ï¼ˆå¹¶å¯è¢«åˆçº¦è¯»å–ï¼‰çš„æ–¹æ³•ï¼Œå¯¹è¾ƒå¤§çš„å¤šè¯æ•°æ®å°¤ä¸ºæœ‰æ•ˆã€‚
- [å…ˆæäº¤ + å†æ­æ™“](./patterns/commit-reveal)
    - ç”¨ä¸€ç§â€œåˆ†ä¸¤æ­¥èµ°â€çš„äº¤æ˜“å¤„ç†æ¨¡å¼æ¥äº§ç”Ÿâ€œåŠæ¨¡ç³Šâ€çš„é“¾ä¸Šè¡Œä¸ºï¼Œç”¨æ¥é˜²æ­¢æŠ¢è·‘äº¤æ˜“å’Œè·Ÿéšäº¤æ˜“ã€‚
- [EIP712 é“¾ä¸‹æ¶ˆæ¯ç­¾å](./patterns/eip712-signed-messages)
    - å¯ä¾›äººç†è§£çš„ JSON æ ¼å¼çš„ä¿¡æ¯åœ¨é“¾ä¸‹è¢«ç­¾åï¼Œéšåå¯åœ¨é“¾ä¸Šæ‰§è¡Œã€‚
- [ERC20 çš„ï¼ˆä¸ï¼‰å…¼å®¹æ€§](./patterns/erc20-compatibility)
    - æ­£ç¡®åœ°å…¼å®¹ç¬¦åˆæ ‡å‡†è§„èŒƒå’Œä¸ç¬¦åˆæ ‡å‡†è§„èŒƒï¼ˆæ¯”ä½ æƒ³è±¡ä¸­æ›´åŠ å¸¸è§çš„ï¼‰çš„ ERC20 ä»£å¸å®ç°ã€‚
- [ERC20 ä»£å¸çš„ EIP2612 æˆæƒè®¸å¯](./patterns/erc20-permit)
    - å…ˆæˆæƒå†è½¬ç§» ERC20 ä»£å¸ä»…éœ€è¦*ä¸€ç¬”*é“¾ä¸Šäº¤æ˜“ã€‚
- [`eth_call` æŠ€å·§](./patterns/eth_call-tricks)
    - ä½¿ç”¨ `eth_call` æ‰§è¡Œå¿«é€Ÿä¸”å¤æ‚çš„é“¾ä¸Šæ•°æ®æŸ¥è¯¢ä»¥åŠé›¶æˆæœ¬çš„è°ƒç”¨æ¨¡æ‹Ÿã€‚
- [æ˜¾å¼å­˜å‚¨æ¡¶](./patterns/explicit-storage-buckets)
    - ä¸ºå¯å‡çº§åˆçº¦æä¾›æ›´å®‰å…¨ã€æœ‰ä¿è¯çš„éé‡å å­˜å‚¨ã€‚
- [ä¸ªäººé’±åŒ…åœ°å€ï¼ˆéåˆçº¦åœ°å€ï¼‰ç±»å‹æ£€æŸ¥](./patterns/eoa-checks)
    - ä»‹ç»ä¸ä¸ªäººåœ°å€å’Œåˆçº¦åœ°å€äº¤äº’ä¼šäº§ç”Ÿçš„ä¸åŒåæœä»¥åŠå¦‚ä½•ç”„åˆ«è¿™ä¸¤ç§åœ°å€ã€‚
- [å·¥å‚è¯æ˜](./patterns/factory-proofs)
    - åœ¨é“¾ä¸Šè¯æ˜åˆçº¦æ˜¯ç”±å¯ä¿¡ä»»çš„éƒ¨ç½²äººéƒ¨ç½²çš„ã€‚
- [é—ªç”µè´·](./patterns/flash-loans/)
    - è®¾è®¡ä¸€ä¸ªåŸºæœ¬çš„é—ªç”µè´·æœºåˆ¶.
- [åˆå§‹åŒ–å¯å‡çº§åˆçº¦](./patterns/initializing-upgradeable-contracts)
    - å®‰å…¨ä¸”é«˜æ•ˆåœ°ä¸ºä»£ç†åˆçº¦åˆå§‹åŒ–å˜é‡çš„æ–¹æ³•ã€‚
- [é»˜å…‹å°”è¯æ˜](./patterns/merkle-proofs)
    - è¯æ˜æ½œåœ¨å¤§å‹å›ºå®šé›†åˆæˆå‘˜èµ„æ ¼çš„é«˜æ•ˆå­˜å‚¨æ–¹æ³•ã€‚
- [Multicall](./patterns/multicall)
    - å…è®¸ç”¨æˆ·åœ¨å•æ¬¡äº¤æ˜“ä¸­ä»»æ„ç»„åˆå’Œæ‰§è¡Œå¤šä¸ªæ“ä½œã€‚
- [NFT æ¥æ”¶é’©å­](./patterns/nft-receive-hooks)
    - ä½¿ç”¨ ERC721/ERC1155 è½¬ç§»å›è°ƒä»¥é¿å…ç”¨æˆ·æå‰è®¾ç½®é™é¢ã€‚
- [é“¾ä¸‹å­˜å‚¨](./patterns/off-chain-storage)
    - é€šè¿‡å°†åˆçº¦çŠ¶æ€ç§»å‡ºé“¾ä¸‹ï¼Œæå¤§åœ°é™ä½ gas æˆæœ¬ã€‚
- [ä»…å…è®¸å§”æ‰˜è°ƒç”¨ / ä¸å…è®¸å§”æ‰˜è°ƒç”¨](./patterns/only-delegatecall-no-delegatecall/)
    - é™åˆ¶å‡½æ•°æ˜¯å¦åªèƒ½åœ¨å§”æ‰˜è°ƒç”¨ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ã€‚
- [æ‰“åŒ…å­˜å‚¨](./patterns/packing-storage)
    - ç¼–æ’å­˜å‚¨å˜é‡ï¼Œä»¥å‡å°‘æ˜‚è´µçš„å­˜å‚¨è®¿é—®ã€‚
- [Permit2](./patterns/permit2)
    - é€‚ç”¨äºæ‰€æœ‰ï¼ˆä¼ ç»Ÿå’Œç°ä»£ï¼‰ERC20 çš„æ–¹å¼å®‰å…¨åœ°è½¬ç§»ä»£å¸ï¼Œæ— éœ€ç›´æ¥æˆæƒé¢åº¦ã€‚
- [åªè¯»å§”æ‰˜è°ƒç”¨](./patterns/readonly-delegatecall)
    - ä»¥åªè¯»æ–¹å¼æ‰§è¡Œåˆçº¦ä¸­çš„ä»»æ„å§”æ‰˜è°ƒç”¨ï¼Œå¹¶ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚
- [å°†æˆæƒè½¬è´¦æƒé™çš„åˆçº¦å•ç‹¬æŠ½è±¡å‡ºæ¥](./patterns/separate-allowance-targets/)
    - é¿å…åœ¨æŸä¸ªè¢«æˆæƒäº†è½¬è´¦æƒé™çš„åˆçº¦å‡çº§æ—¶ä¸å¾—ä¸è¿ç§»è¿‡å»è¿›è¡Œçš„æˆæƒã€‚
- [å †æ ˆè¿‡æ·±çš„è§£å†³æ–¹æ¡ˆ](./patterns/stack-too-deep/)
    - é¿å…å †æ ˆè¿‡æ·±é”™è¯¯çš„ç®€æ´è§£å†³æ–¹æ¡ˆã€‚ç®€æ´åˆ°ä½ æ— è®ºå¦‚ä½•éƒ½åº”è¯¥è¿™ä¹ˆåšï¼
- æŒç»­å…³æ³¨ï¼Œä¼šæœ‰æ›´å¤šæ¨¡å¼æ›´æ–°è¿›æ¥ ğŸ˜‰

## å®‰è£…ã€æ„å»ºã€æµ‹è¯•

åœ¨å¼€å§‹ä¹‹å‰ç¡®ä¿ä½ å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ [foundry](https://book.getfoundry.sh/getting-started/installation)ã€‚

```bash
# Clone the repo
$> git clone git@github.com:dragonfly-xyz/useful-solidity-patterns.git
# Install foundry dependencies
$> forge install
# Run tests
$> forge test -vvv
# Run forked tests
$> forge test -vvv --fork-url $YOUR_NODE_RPC_URL -m testFork
```

## æ„Ÿè°¢
æœ¬ä»“åº“æ˜¯ [useful-solidity-patterns](https://github.com/dragonfly-xyz/useful-solidity-patterns/tree/main) çš„ä¸­æ–‡è¯‘æœ¬ï¼Œéå¸¸æ„Ÿè°¢ [dragonfly_xyz](https://twitter.com/dragonfly_xyz) ä¸ºç¤¾åŒºè´¡çŒ®äº†è¿™ä¹ˆä¼˜è´¨çš„å†…å®¹ã€‚
